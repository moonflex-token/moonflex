<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Widget</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .widget {
            display: inline-block;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .price {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="widget">
        <h2>Live Prices</h2>
        <div>
            <p>XRP/USD: <span id="xrpPrice" class="price">Loading...</span></p>
            <p>MFX/USD: <span id="mfxPrice" class="price">Loading...</span></p>
        </div>
    </div>

    <script src="https://unpkg.com/xrpl/dist/xrpl.js"></script>
    <script>
        (async function() {
            const xrpUsdElement = document.getElementById('xrpPrice');
            const mfxUsdElement = document.getElementById('mfxPrice');

            const xrpl = window.xrpl;
            const client = new xrpl.Client("wss://xrplcluster.com"); // Use mainnet for live prices

            const USD_ISSUER = "rhub8VRN55s94qWKDv6jmDy1pUykJzF3wq"; // GateHub USD issuer
            const MFX_ISSUER = "rfUhMQYijKvStp96CUxDNp8ukYJAebNrJ1";

            async function fetchPrice() {
                try {
                    console.log("Connecting to XRPL...");
                    await client.connect();

                    // Fetch XRP/USD price
                    console.log("Fetching XRP/USD price...");
                    const xrpUsdRequest = {
                        command: "book_offers",
                        taker_gets: {
                            currency: "XRP"
                        },
                        taker_pays: {
                            currency: "USD",
                            issuer: USD_ISSUER
                        }
                    };
                    const xrpUsdResponse = await client.request(xrpUsdRequest);
                    console.log("XRP/USD Response:", xrpUsdResponse);

                    if (!xrpUsdResponse.result.offers.length) {
                        throw new Error("No offers available for XRP/USD.");
                    }

                    const xrpUsdRate = parseFloat(xrpUsdResponse.result.offers[0].quality);
                    console.log("XRP/USD Rate:", xrpUsdRate);

                    // Fetch MFX/XRP price
                    console.log("Fetching MFX/XRP price...");
                    const mfxXrpRequest = {
                        command: "book_offers",
                        taker_gets: {
                            currency: "MFX",
                            issuer: MFX_ISSUER
                        },
                        taker_pays: {
                            currency: "XRP"
                        }
                    };
                    const mfxXrpResponse = await client.request(mfxXrpRequest);
                    console.log("MFX/XRP Response:", mfxXrpResponse);

                    if (!mfxXrpResponse.result.offers.length) {
                        throw new Error("No offers available for MFX/XRP.");
                    }

                    const mfxXrpRate = 1 / parseFloat(mfxXrpResponse.result.offers[0].quality);
                    console.log("MFX/XRP Rate:", mfxXrpRate);

                    // Calculate MFX/USD price
                    const mfxUsdRate = mfxXrpRate * xrpUsdRate;
                    console.log("MFX/USD Rate:", mfxUsdRate);

                    // Update the HTML
                    xrpUsdElement.textContent = xrpUsdRate.toFixed(4);
                    mfxUsdElement.textContent = mfxUsdRate.toFixed(4);
                } catch (error) {
                    console.error("Error fetching prices:", error);
                    xrpUsdElement.textContent = "Error";
                    mfxUsdElement.textContent = "Error";
                } finally {
                    console.log("Disconnecting from XRPL...");
                    client.disconnect();
                }
            }

            fetchPrice();
        })();
    </script>
</body>
</html>
