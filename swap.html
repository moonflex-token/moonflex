<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MoonFlex Token Swap</title>
    <link rel="icon" href="moonflex-favicon.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #121212;
            color: #fff;
        }

        h1,
        h2 {
            color: #ff6600;
        }

        .container {
            width: 80%;
            margin: auto;
        }

        .section {
            margin: 50px 0;
        }

        .content {
            text-align: center;
        }

        .swap-container {
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
        }

        .swap-button {
            padding: 10px 20px;
            background-color: #ff6600;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
        }

        .swap-button:hover {
            background-color: #ffcc00;
        }

        .qr-code-container {
            margin-top: 30px;
        }

        .qr-code {
            max-width: 200px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input {
            padding: 10px;
            width: 200px;
            border-radius: 5px;
            border: none;
            margin-right: 10px;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <div class="hamburger" id="hamburger">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul id="menu">
                <li><a href="#page-1">Home</a></li>
                <li><a href="#page-2">Tokenomics</a></li>
                <li><a href="#page-3">Roadmap</a></li>
                <li><a href="#page-4">Liquidity Incentive</a></li>
                <li><a href="#page-5">Founder Vesting</a></li>
                <li><a href="#page-6">Token Utility</a></li>
                <li><a href="#page-7">Lunar Link-Up</a></li>
                <li><a href="#page-8">FAQ</a></li>
                <li><a href="whitepaper.pdf">Whitepaper</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <!-- Swap Section -->
        <section class="section" id="swap-section">
            <div class="content">
                <h1>Swap XRP to MFX or MFX to XRP</h1>
                <p>Select the amount and choose the swap direction.</p>
            </div>

            <div class="swap-container">
                <!-- Swap Form -->
                <div class="form-group">
                    <input type="number" id="amount" placeholder="Amount" />
                    <select id="direction">
                        <option value="xrp-to-mfx">XRP to MFX</option>
                        <option value="mfx-to-xrp">MFX to XRP</option>
                    </select>
                </div>
                <button class="swap-button" id="swapButton">Swap</button>
            </div>

            <div class="qr-code-container">
                <h2>Connect with Xaman Wallet</h2>
                <button id="connectButton" class="swap-button">Connect Wallet</button>
                <div id="qrCode"></div>
            </div>

            <div id="status" style="color: #ff6600;"></div>
        </section>
    </div>

    <!-- Include the required libraries -->
    <script src="https://cdn.jsdelivr.net/npm/xrpl@1.3.1/dist/xrpl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xamagnetic/xaman-wallet@1.0.1/dist/xaman.min.js"></script>
    <script>
        const connectButton = document.getElementById('connectButton');
        const qrCodeContainer = document.getElementById('qrCode');
        const statusDiv = document.getElementById('status');

        let xamanWallet;

        // Connect to Xaman wallet
        connectButton.addEventListener('click', async () => {
            try {
                xamanWallet = new XamanWallet();
                const isConnected = await xamanWallet.connect();

                if (isConnected) {
                    const qrCodeUrl = await xamanWallet.getQRCode();
                    qrCodeContainer.innerHTML = `<img class="qr-code" src="${qrCodeUrl}" alt="QR Code" />`;
                    statusDiv.textContent = "Wallet Connected!";
                } else {
                    statusDiv.textContent = "Error connecting wallet. Please try again.";
                }
            } catch (error) {
                console.error('Error connecting wallet:', error);
                statusDiv.textContent = "Error connecting wallet. Please try again.";
            }
        });

        // Handle the swap logic
        const swapButton = document.getElementById('swapButton');
        const amountInput = document.getElementById('amount');
        const directionSelect = document.getElementById('direction');

        swapButton.addEventListener('click', async () => {
            const amount = parseFloat(amountInput.value);
            const direction = directionSelect.value;
            if (!amount || amount <= 0) {
                statusDiv.textContent = "Please enter a valid amount.";
                return;
            }

            // Fetch order book and check liquidity
            const client = new xrpl.Client("wss://s2.ripple.com");
            await client.connect();

            let orderBook;
            if (direction === 'xrp-to-mfx') {
                orderBook = await client.request({
                    command: 'book_offers',
                    taker_gets: {
                        currency: 'XRP'
                    },
                    taker_pays: {
                        currency: 'MFX',
                        issuer: 'rfUhMQYijKvStp96CUxDNp8ukYJAebNrJ1'
                    }
                });
            } else {
                orderBook = await client.request({
                    command: 'book_offers',
                    taker_gets: {
                        currency: 'MFX',
                        issuer: 'rfUhMQYijKvStp96CUxDNp8ukYJAebNrJ1'
                    },
                    taker_pays: {
                        currency: 'XRP'
                    }
                });
            }

            const bestOffer = orderBook.result.offers[0];
            if (!bestOffer) {
                statusDiv.textContent = "No offers available.";
                return;
            }

            const price = parseFloat(bestOffer.TakerGets.value) / parseFloat(bestOffer.TakerPays.value);
            const slippageAllowed = price * 1.01;

            // Perform swap transaction (simplified)
            const transaction = {
                "TransactionType": "Payment",
                "Account": xamanWallet.address,
                "Amount": xrpl.xrpToDrops(amount),
                "Destination": 'rfUhMQYijKvStp96CUxDNp8ukYJAebNrJ1',
                "SendMax": xrpl.xrpToDrops(amount * slippageAllowed),
            };

            await xamanWallet.submitTransaction(transaction);
            statusDiv.textContent = "Swap successful!";
        });
    </script>
</body>

</html>
