<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Proof of Reserves – MFX/XRP Market Makers & AMM Pools</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; margin: 0; padding: 2rem; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); padding: 1.5rem; margin-bottom: 2rem; }
    h1, h2 { margin-top: 0; }
    .summary { display: flex; justify-content: space-around; margin-bottom: 1.5rem; }
    .summary div { text-align: center; }
    .summary .value { font-size: 2rem; font-weight: bold; }
    ul { list-style: none; padding-left: 0; }
    li + li { margin-top: 0.5rem; }
    .info { font-size: 0.9rem; color: #555; margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem; }
    .spinner { display: inline-block; width: 1em; height: 1em; border: 0.2em solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite; vertical-align: text-bottom; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xrpl@2.8.0/build/xrpl-latest-min.js"></script>
</head>
<body>
  <!-- AMM Pool MFX/RLUSD Card with amm_info -->
  <div class="card">
    <h2>AMM Pool Reserves: MFX/RLUSD</h2>
    <div id="summaryPool2" class="summary">
      <div><div class="value" id="pool2MFX">—</div><div>MFX in Pool</div></div>
      <div><div class="value" id="pool2RLUSD">—</div><div>RLUSD in Pool</div></div>
    </div>
    <div id="balancesPool2"><span class="spinner"></span> Fetching pool reserves…</div>
    <div class="info">AMM pool for <strong>MFX/RLUSD</strong>, showing current liquidity.</div>
  </div>

  <script>
    (async () => {
      const pool2Address = 'rLu93AUSPt7kFXTjo76Tum9nf19HtpnZRA';
      const issuerMFX = 'rfUhMQYijKvStp96CUxDNp8ukYJAebNrJ1';
      const issuerRLUSD = 'rMxCKbEDwqr76QuheSUMdEGf4B9xJ8m5De';
      const rlusdHex = '524C555344000000000000000000000000000000';
      const elPool2 = document.getElementById('balancesPool2');

      try {
        const client = new xrpl.Client('wss://s1.ripple.com');
        await client.connect();

        // Fetch AMM info
        const resp = await client.request({
          command: 'amm_info',
          amm_account: pool2Address
        });
        const data = resp.result.amm || resp.result;

        let baseAmount = null, quoteAmount = null;
        [data.amount, data.amount2].forEach(amt => {
          if (typeof amt === 'object') {
            const curr = amt.currency || amt.currency_hex;
            const issuer = amt.issuer;
            const val = parseFloat(amt.value || amt.amount || 0);
            // MFX is base
            if (issuer === issuerMFX && (curr === 'MFX')) baseAmount = val;
            // RLUSD is quote, match hex or currency
            if (issuer === issuerRLUSD && (curr === 'RLUSD' || curr === rlusdHex)) quoteAmount = val;
          }
        });

        if (baseAmount === null || quoteAmount === null) {
          console.error('Parsed AMM data:', data);
          throw new Error('Could not parse MFX/RLUSD AMM info');
        }

        elPool2.innerHTML = `<ul><li>MFX: ${baseAmount.toFixed(4)}</li><li>RLUSD: ${quoteAmount.toFixed(4)}</li></ul>`;
        document.getElementById('pool2MFX').textContent = baseAmount.toFixed(4);
        document.getElementById('pool2RLUSD').textContent = quoteAmount.toFixed(4);

        await client.disconnect();
      } catch (e) {
        console.error(e);
        elPool2.textContent = '⚠️ Error fetching pool reserves; see console.';
      }
    })();
  </script>
</body>
</html>
